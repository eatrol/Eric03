<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>


    <style>
            /* The Modal (background) */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        padding-top: 100px; /* Location of the box */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.9); /* Black w/ opacity */
        text-align: center;
    }

    .drawmodal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        padding-top: 100px; /* Location of the box */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.8); /* Black w/ opacity */
        text-align: center;
    }


    </style>
</head>
<body>
    
    <div id="myModal" class="modal">
        <!-- Modal content -->
        
        <div class="modal-content">
          <img id="modalimg" style="width:600px;height:auto;">
        </div>
        <span class="close">&times;<img src="close.png" style="width:80px;height:auto;"></span>
    </div>

    <!--繪畫板功能-->
    <div id="drawModal" class="drawmodal">
        <!-- Modal content -->
        <div  class="modal-content">
            <canvas id="drawCanvas" width="800px" height="500px" style="border:1px solid #aaaaaa"></canvas>
        </div><br>
        <span class="close">&times;<img src="close.png" style="width:80px;height:auto;"></span>
    </div>

    <canvas id="cvs" width="800px" height="600px" style="border:1px solid #000000" ></canvas>

    <script type="text/javascript">
        var cvs=document.getElementById("cvs");
        var ctx=cvs.getContext("2d");
        var cvs2=document.getElementById("drawCanvas");
        var ctx2=cvs2.getContext("2d");
        var touchX,touchY;
        var started = false

        // Get the modal
        var modal = document.getElementById("myModal");
        var drawmodal = document.getElementById("drawModal");
        var span = document.getElementsByClassName("close")[0];
        var drawspan = document.getElementsByClassName("close")[1];
        var modalimg = document.getElementById("modalimg");

        // 載入資料庫
        var lucy_bg = "bg4.png"

        var lucy_word = "Truck"
        var lucy_word_size = window.innerWidth/5;
        var lucy_sound = "https://s.yimg.com/bg/dict/dreye/live/m/truck.mp3";
        var lucy_img = "truck.png"
        var lucy_pic = "mario1.png";
        var factor = window.innerWidth/800;
        var lucy_letter = ['t','r','u','c','k'];
        var lucy_speak = new newsound("https://s.yimg.com/bg/dict/dreye/live/m/truck.mp3")
 

        function init(){
            cvs.height = window.innerHeight;    // 設定外觀尺寸
            cvs.width = window.innerWidth;

            cvs2.width = window.innerWidth; 
            cvs2.height = window.innerHeight/2;

            ctx.font = lucy_word_size + 'pt Calibri';   // 設定字體大小
            ctx.textAlign = 'center'                    // 設定字體致中
            ctx.fillStyle="white";                      // 設定字體顏色
            modalimg.src = "truck.png"
            modalimg.style.width = 400*factor + 'px';
        }

        // 宣告按鍵
        var myobs= [];
        myobs[0]= new newbtn(window.innerWidth/2-40*factor,window.innerHeight/2+80*factor,600*factor/7,600*factor/7,"lucy-sound.png",lucy_sound);
        myobs[1]= new newbtn(window.innerWidth/2+100*factor,window.innerHeight/2+60*factor,600*factor/6,600*factor/6,"answer.png","coin.mp3");
        myobs[2]= new newbtn(window.innerWidth/2+200*factor,window.innerHeight/2+75*factor,600*factor/7,600*factor/7,"chinese.png","");
        myobs[3]= new newbtn(window.innerWidth/2-200*factor,window.innerHeight/2+75*factor,600*factor/7,600*factor/7,"button03.png","");

        var mybg= [];
        mybg[0]=  new newbg(0,0, window.innerWidth, window.innerHeight,lucy_bg);
        //mybg[1] = new newbg(window.innerWidth*0.1,window.innerHeight*0.1,window.innerWidth*0.8,window.innerHeight*0.5,"menu.png")
        console.log()

        window.onload= function() {
            init();
  
            coinsound = new newsound(lucy_sound);
            for(var i=0;i<mybg.length; i++){
                mybg[i].draw();
            }
        

            ctx.fillText(lucy_word, cvs.width/2, cvs.height/2);
            for (var i=0; i< myobs.length ; i++){
                var btn = myobs[i];
                btn.draw(); //畫出位置
            }
            
        }

    
        function newsound(src) {
            this.sound = document.createElement("audio");
            this.sound.src = src;
            this.sound.setAttribute("preload", "auto");
            this.sound.setAttribute("controls", "none");
            this.sound.style.display = "none";
            document.body.appendChild(this.sound);
            this.play = function(){
                this.sound.play();
            }
                this.stop = function(){
                    this.sound.pause();
                    this.sound.currentTime = 0;
                }
        }     

    cvs.onmousedown = function (e) {
        touchX = e.offsetX;
        touchY = e.offsetY;
        myobs[0].isTouch()
        if (myobs[1].isTouch()){ modal.style.display = "block"; }
        if (myobs[2].isTouch()){
            lucy_speak.sound.src = "https://s.yimg.com/bg/dict/dreye/live/m/" + "t" +".mp3" 
            setTimeout(lucy_speak.play(),2000)
            //lucy_speak.play();
        }

        if (myobs[3].isTouch()){ 
            ctx2.clearRect(0,0,8000,8000);
            drawmodal.style.display = "block"; 
        }

    
    }


    span.onclick = function() {
        modal.style.display = "none";
       // drawmodal.style.display="none";
    }

    drawspan.onclick = function() {
       // modal.style.display = "none";
        drawmodal.style.display="none";
    }


    // canvas 滑鼠按下 ：開啟 beginPath 
    cvs2.onmousedown = function (e) {
        ctx2.strokeStyle = '#00f';
        ctx2.lineWidth = 30;
        ctx2.lineCap = 'round';
        ctx2.globalAlpha = 1; 
        ctx2.beginPath();
        started = true;
        //e.preventDefault();
    }

    // canvas 滑鼠移動 : 開始畫線
    cvs2.onmousemove = function (e) {
        if (started) {
            ctx2.lineTo(e.offsetX, e.offsetY);
            ctx2.stroke();
        }
    }
    // canvas 滑鼠移動
    cvs2.onmouseup = function (e) {
        if (started) {
            started = false;
        }
    }
    // --------------------------------
    // canvas 觸碰 : 開始畫線 --------------------------
    cvs2.ontouchstart = function (e) {
        ctx2.strokeStyle = '#0ff';
        ctx2.lineWidth = 30;
        ctx2.lineCap = 'round';
        ctx2.globalAlpha = 1; 
        ctx2.beginPath();
        started = true;
        e.preventDefault();     // 觸碰要增加這行
    }

    // canvas 觸碰移動 : 開始畫線
    cvs2.ontouchmove = function (e) {
        this.touch=e.targetTouches[0];
        this.touch.pageY =this.touch.pageY-100;  //要做修正, CAVNAS跟觸碰區有距離差
        if (started) {
            ctx2.lineTo(this.touch.pageX, this.touch.pageY);  
            ctx2.stroke();
        }
        e.preventDefault();     // 觸碰要增加這行
    }

    // canvas 觸碰結束
    cvs2.ontouchend = function (e) {
        if (started) {
            started = false;
        }
        e.preventDefault();
    }
    
 
    // 物件1 : 可觸碰的按鍵
    function newbtn(btnx,btny,btnw,btnh,btnpic,btnsound){
        this.x = btnx;
        this.y = btny;
        this.width = btnw;
        this.height = btnh; 
        this.image = new Image()
        this.image.src = btnpic;
        this.sound = new newsound(btnsound);
    
        this.draw = function(){
            ctx.drawImage(this.image,this.x, this.y , this.width ,this.height);
        }
        this.isTouch = function(obj){
            var myleft = this.x;
            var myright = this.x + this.width;
            var mytop = this.y;
            var mybot = this.y + this.height;
            if (myright> touchX && myleft < touchX && mytop < touchY && mybot > touchY ){
                this.sound.play();
                return true;
            }else{
                return false;
            }
        } 
    }

    // 物件2 : 圖片
    function newbg(btnx,btny,btnw,btnh,btnpic){
        this.x = btnx;
        this.y = btny;
        this.width = btnw;
        this.height = btnh; 
        this.image = new Image()
        this.image.src = btnpic;

        this.draw = function(){
            ctx.drawImage(this.image,this.x, this.y , this.width ,this.height);
        }
    }


    </script>

    
</body>
</html>