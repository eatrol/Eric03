<!----phaser 學習 lesson 2 

教學網址: https://medium.com/alpha-camp-%E5%8F%B0%E7%81%A3/%E6%8A%80%E8%A1%93%E7%AD%86%E8%A8%98-ac-meetup-phaser%E9%81%8A%E6%88%B2%E5%BC%95%E6%93%8E-11bfc4be1827

遊戲素材網：https://itch.io/game-assets/free/tag-2d

目的： 1. 用鍵盤按鍵來操控主角往右走
      2. 在config設定物理特性,重力
      3. 套用在主角及地板

--->

<html>
<head>
<title>phaser game 1</title>
<script src="//cdn.jsdelivr.net/npm/phaser@3.52.0/dist/phaser.js"></script>
<script src="//cdn.jsdelivr.net/npm/phaser@3.52.0/dist/phaser.min.js"></script>

<script type="text/javascript">

// 基本設定
const gameStart = {
    key: 'gameStart',
    preload: function(){
        // 載入資源
        this.load.image('bg1', 'jungle/bg/plx-1.png');
        this.load.image('bg2', 'jungle/bg/plx-2.png');
        this.load.image('bg3', 'jungle/bg/plx-3.png');
        this.load.image('bg4', 'jungle/bg/plx-4.png');
        this.load.image('bg5', 'jungle/bg/plx-5.png');
        this.load.image('bg6', 'jungle/bg/foot.png');

        this.load.spritesheet('user', 'jungle/runSheet.png', {frameWidth: 116, frameHeight: 66});

        this.load.image('star', 'jungle/bg/coin.png');

    },


    create: function(){
        // 資源載入完成，在世界加入遊戲物件及相關設定
        this.bg1 = this.add.tileSprite(400, 300, 800, 600, 'bg1'); //遊戲中心X,遊戲中心Y,遊戲世界長,遊戲世界寬
        this.bg2 = this.add.tileSprite(400, 300, 800, 600, 'bg2');
        this.bg3 = this.add.tileSprite(400, 300, 800, 600, 'bg3');
        this.bg4 = this.add.tileSprite(400, 300, 800, 600, 'bg4');
        this.bg5 = this.add.tileSprite(400, 300, 800, 600, 'bg5');

        // 加入地板, 並設定物理條件
        this.bg6 = this.add.tileSprite(400, 470, 800, 600, 'bg6');
        this.physics.add.existing(this.bg6);

        // 設定物件不會動靜止不會掉下去
        this.bg6.body.immovable = true;
        // 物件的位置和旋轉是否受其速度，加速度，阻力和重力的影響
        this.bg6.body.moves = false;

       
        this.player = this.physics.add.sprite(400, 100, 'user');
        this.player.setScale(1);


        this.anims.create({
            key: 'right',
            frames: this.anims.generateFrameNumbers('user', { start: 0, end: 5 }),  // 從第0 到第5個小圖
            frameRate: 10,
            repeat: -1
        })

        this.anims.create({
            key: 'stop',
            frames: this.anims.generateFrameNumbers('user', { start: 0, end: 1 }),  // 從第0 到第5個小圖
            frameRate: 10,
            repeat: -1
        })

        /* 產生12顆星星 */
        /* 星星是動態物體，會彈跳，會被玩家吃掉，所以不能設成staticGroup */
        this.star = this.physics.add.group({
            key: 'star',
            repeat : 11,
            setXY: {x:12, y:0,stepX:70}
        })

      
        //設定角色彈跳值
        this.player.setBounce(0.5);
        //this,player.setGravityY(100);
        //設定角色碰撞邊界
        this.player.setSize(110, 66, 0);


        /* 加入這一行,表示player跟物件(bg6)有碰撞事件 */
        this.physics.add.collider(this.player, this.bg6);

        // 偵測鍵盤事件
        cursors = this.input.keyboard.createCursorKeys();

    },

    update: function(){
        // 遊戲狀態更新

        // 按下右鍵, 主角往右跑步
        if (cursors.right.isDown ){
            this.player.anims.play('right',true);  
            moveRight(3,this.bg1,this.bg2,this.bg3,this.bg4,this.bg5,this.bg6);

        }

        // 按下左鍵, 主角往左跑步
        if (cursors.left.isDown){
            this.player.anims.play('right',true);   
            moveRight(-3,this.bg1,this.bg2,this.bg3,this.bg4,this.bg5,this.bg6);
        }

        // 放開左鍵 or , 停止
        if (cursors.left.isUp && cursors.right.isUp){
            this.player.anims.play('right',false);  // 加這行的目的是希望停止時 主角畫面用雪碧圖的第一格
            this.player.anims.stop('right',true);   
        }

        // 按下上鍵, 主角往上跳
        if (cursors.space.isDown){
            this.player.setVelocityY(800);
        }
        
 
    }
 
}


const config = {
    type: Phaser.CANVAS,  // 渲染方式 phaser.WEBGL 或 phaser.CANVAS  或 phaser.AUTO
    width: 800,
    height: 200,
    parent: 'app',
    physics: {                 //  物理設定
         default: 'arcade',    // 設定物理世界為'arcade' , 參數為重力 1500
         arcade: {
             gravity: {
                 y: 1500
             }
         },
     },

     scene: [ gameStart]
}

function moveRight(speed,bg1,bg2,bg3,bg4,bg5,bg6){
    //alert('hi');
    bg1.tilePositionX += speed; 
    bg2.tilePositionX += speed; 
    bg3.tilePositionX += speed; 
    bg4.tilePositionX += speed; 
    bg5.tilePositionX += speed; 
    bg6.tilePositionX += speed; 
  
}




const game = new Phaser.Game(config); // 建立遊戲世界




</script>


</head>

<body>

    <div id=’app’></div>

</body>

</html>