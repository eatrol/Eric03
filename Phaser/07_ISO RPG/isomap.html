<!----phaser 學習 lesson 2 

教學網址: https://medium.com/alpha-camp-%E5%8F%B0%E7%81%A3/%E6%8A%80%E8%A1%93%E7%AD%86%E8%A8%98-ac-meetup-phaser%E9%81%8A%E6%88%B2%E5%BC%95%E6%93%8E-11bfc4be1827

遊戲素材網：https://itch.io/game-assets/free/tag-2d

目的： 1. 用鍵盤按鍵來操控主角往右走
      2. 在config設定物理特性,重力
      3. 套用在主角及地板

--->

<html>
<head>
<title>phaser game 1</title>
<script src="//cdn.jsdelivr.net/npm/phaser@3.52.0/dist/phaser.js"></script>
<script src="//cdn.jsdelivr.net/npm/phaser@3.52.0/dist/phaser.min.js"></script>

<script type="text/javascript">

// 基本設定
var sWidth = 800;
var sHeight = 600;
var sFactor = 2


const gameStart = {
    key: 'gameStart',
    preload: function(){
        // 載入資源

        this.load.image('back01','isocity/isomap.png');
        
        //this.load.image('bg6', 'jungle/bg/foot.png');

        this.load.spritesheet('user', 'isocity/runSheet.png', {frameWidth: 116, frameHeight: 66});

        //this.load.image('star', 'jungle/bg/coin.png');

    },


    create: function(){
        // 資源載入完成，在世界加入遊戲物件及相關設定


        this.back01 = this.add.tileSprite(sWidth/2, sHeight/2, sWidth, sHeight, 'back01');
        this.back01.setScale(sFactor);
       
        this.player = this.physics.add.sprite(400, 100, 'user');
        this.player.setScale(1);


        this.anims.create({
            key: 'right',
            frames: this.anims.generateFrameNumbers('user', { start: 0, end: 5 }),  // 從第0 到第5個小圖
            frameRate: 10,
            repeat: -1
        })

        this.anims.create({
            key: 'stop',
            frames: this.anims.generateFrameNumbers('user', { start: 0, end: 1 }),  // 從第0 到第5個小圖
            frameRate: 10,
            repeat: -1
        })

   

      
        //設定角色彈跳值
        this.player.setBounce(0.4);
        //this,player.setGravityY(100);
        //設定角色碰撞邊界
        this.player.setSize(110, 66, 0);


        /* 加入這一行,表示player跟物件(bg6)有碰撞事件 */
        //this.physics.add.collider(this.player, this.bg6);

        // 偵測鍵盤事件
        cursors = this.input.keyboard.createCursorKeys();
        keyZ = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Z);
        keyX = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.X);

    },

    update: function(){
        // 遊戲狀態更新

        // 按下右鍵, 主角往右跑步
        if (cursors.up.isDown ){
            this.player.anims.play('right',true);  
            moveRight(-3,this.back01);

        }

        // 按下左鍵, 主角往左跑步
        if (cursors.down.isDown){
            this.player.anims.play('right',true);   
            moveRight(3,this.back01);
        }

        // 放開左鍵 or , 停止
        if (cursors.up.isUp && cursors.down.isUp && cursors.right.isUp && cursors.left.isUp ){
            this.player.anims.play('right',false);  // 加這行的目的是希望停止時 主角畫面用雪碧圖的第一格
            this.player.anims.stop('right',true);   
        }

        // 按下上鍵, 主角往上跳
        if (cursors.right.isDown){
            this.player.anims.play('right',true);   
            moveUp(3,this.back01);
        }

        if (cursors.left.isDown){
            this.player.anims.play('right',true);   
            moveUp(-3,this.back01);
        }

        if (keyZ.isDown){
            sFactor = sFactor + 0.1;
            this.back01.setScale(sFactor)
        }
        if (keyX.isDown){
            sFactor = sFactor - 0.1;
            this.back01.setScale(sFactor)
        }
        
 
    }
 
}


const config = {
    type: Phaser.CANVAS,  // 渲染方式 phaser.WEBGL 或 phaser.CANVAS  或 phaser.AUTO
    width: sWidth,
    height: sHeight,
    parent: 'app',
    physics: {                 //  物理設定
         default: 'arcade',    // 設定物理世界為'arcade' , 參數為重力 1500
         arcade: {
             gravity: {
                 y: 0
             }
         },
     },

     scene: [ gameStart]
}

function moveRight(speed,back01){
    //alert('hi');
    back01.tilePositionX += speed; 
    back01.tilePositionY += speed*0.5;
  
}

function moveUp(speed,back01){
    back01.tilePositionX += speed; 
    back01.tilePositionY += -speed*0.5;   
}




const game = new Phaser.Game(config); // 建立遊戲世界




</script>


</head>

<body>

    <div id=’app’></div>

</body>

</html>