<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Making your first Phaser 3 Game - Part 10</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">





var player;
var stars;
var bombs;
var platforms;
var cursors;
var score = 0;
var gameOver = false;
var scoreText;

var config = {
    type: Phaser.CANVAS,
    width: 800,
    height: 600,
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 200 },
            debug: false
        }
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

const game = new Phaser.Game(config);

function preload(){
    this.load.image('ground', 'assets/background.png');
    this.load.image('tank', 'assets/tank.png');
    this.load.image('turret', 'assets/turret.png');
    this.load.image('bullet', 'assets/bullet.png');
    this.load.image('flame', 'assets/flame.png');
    this.load.image('target', 'assets/target.png');
}
function create(){
    console.log(this);
    
    this.add.image(400,300,'ground');

    // 加入目標
    target = this.physics.add.group();
    target.create(300,390,'target');
    target.create(500, 390, 'target');
    target.create(700, 390, 'target');
    target.create(900, 390, 'target');
    target.world.gravity.y =0
   
    // 加入子彈
    bullet = this.physics.add.sprite(100,100,'bullet');
    bullet.exist = false;
    bullet.setCollideWorldBounds(true);

    // 加入坦克,砲管
    tank = this.physics.add.sprite(34,483,'tank');
    turret = this.physics.add.sprite(tank.x+30, tank.y,'turret');
    //turret.rotation =1.57;

    // 加入火焰
    flame = this.physics.add.sprite(50,50,'flame');

    //flame.anchor.set(0.5);
    flame.visible = false;    // 預設不可見

    // 加入火力
    power = 300;
    ptext = this.add.text(8,8,'power:300',{font:'18px Arial',fill:'#aaaaaa'});
    ptext.setShadow(1,1,'rgba(0,0,0,0.8)',1)
    ptext.fixedToCamera=true;       // 位置固定在鏡頭


    cursors = this.input.keyboard.createCursorKeys(); 
    this.cameras
    console.log(cursors.space);

}
function update(){
    if(bullet.exist){
        return;
    }
  
    if (cursors.space.isDown){
        fire();
    }
}


function fire(){
    if(bullet.exist){
        return;
    }

    //console.log(Phaser); 
    var p= Phaser.Geom.Point(turret.x,turret.y);
   // p.rotate(p.x,p.y,turret.rotation,false,32);
    
    flame.x = turret.x
    flame.y = turret.y
    flame.alpha = 1;
    flame.visible = true;
    //this.physics.pause();
    console.log(flame);
    flame.add.tween
    //this.add.tween(flame).to({alpha:0},100,'Linear',true);
}






</script>

</body>
</html>